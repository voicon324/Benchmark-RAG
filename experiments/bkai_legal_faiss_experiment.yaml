# BKAI Legal Data Retrieval Experiment with FAISS Integration
# This configuration tests retrieval models on Vietnamese legal data using FAISS for efficient search

description: "BKAI Legal Data Retrieval Benchmark with FAISS"

models:
  # - name: "bm25_baseline"
  #   type: "sparse"
  #   model_name_or_path: ""  # BM25 doesn't need a pre-trained model path
  #   parameters:
  #     k1: 1.2
  #     b: 0.75
  #   device: "cpu"  # BM25 always uses CPU

  - name: "sentence_bert_faiss_flat"
    type: "dense" 
    model_name_or_path: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
    parameters:
      normalize_embeddings: true
      model_architecture: "sentence_transformer"
      # FAISS configuration for exact search
      use_ann_index: true
      ann_backend: "faiss"
      faiss_index_factory_string: "Flat"
      faiss_metric_type: "METRIC_INNER_PRODUCT"  # Since we normalize embeddings
    device: "cuda"
    batch_size: 128
    max_seq_length: 512

  - name: "sentence_bert_faiss_ivf"
    type: "dense" 
    model_name_or_path: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
    parameters:
      normalize_embeddings: true
      model_architecture: "sentence_transformer"
      # FAISS configuration for approximate search
      use_ann_index: true
      ann_backend: "faiss"
      faiss_index_factory_string: "IVF100,Flat"
      faiss_nprobe: 10
      faiss_metric_type: "METRIC_INNER_PRODUCT"
    device: "cuda"
    batch_size: 128
    max_seq_length: 512

datasets:
  - name: "bkai_legal_data"
    type: "text"
    data_dir: "/home/hkduy/NewAI/new_bench/BKAI_law_data/newaibench_formatted_data/legal_data"
    # max_samples: 5000  # Start with smaller dataset for FAISS testing
    config_overrides:
      cache_enabled: true
      validation_enabled: true
      queries_file: "train_queries.jsonl"
      qrels_file: "train_qrels.txt"

evaluation:
  metrics: ["ndcg", "map", "recall", "precision"]
  k_values: [1, 3, 5, 10, 20]
  relevance_threshold: 1
  include_per_query: true
  top_k: 100
  save_run_file: true
  run_file_format: "trec"

output:
  output_dir: "./results/bkai_legal_faiss_experiments"
  experiment_name: "bkai_legal_faiss_retrieval"
  save_models: false
  save_intermediate: true
  log_level: "INFO"
  overwrite: true
